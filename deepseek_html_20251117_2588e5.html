<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MAHIR X FALCON AI - Professional Binary Options Trading System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Professional AI-powered binary options analysis using Google Gemini API for accurate 1-minute trading signals">
  <meta name="keywords" content="binary options, trading, AI, Gemini, Quotex, 1-minute signals, OTC, chart analysis">
  <meta name="author" content="Mahir">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --primary:#0a0e17;
      --secondary:#0f1629;
      --accent:#00f7ff;
      --accent-glow:rgba(0,247,255,0.6);
      --buy:#00ff95;
      --sell:#ff2e4c;
      --text:#ffffff;
      --text-secondary:#8a94b3;
      --border:#1a243f;
      --card-bg:rgba(15,22,41,0.9);
      --signal-buy:rgba(0,255,149,0.15);
      --signal-sell:rgba(255,46,76,0.15);
      --otc-color:#ffa500;
      --pattern-color:#ff00ff;
      --high-confidence:#00ff95;
      --medium-confidence:#ffa500;
      --low-confidence:#ff2e4c;
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    
    body{
      font-family:'Rajdhani',sans-serif;
      background:linear-gradient(135deg,#0a0e17 0%,#0f1629 100%);
      color:var(--text);
      min-height:100vh;
      overflow-x:hidden;
    }
    
    .container{max-width:480px;margin:0 auto;padding:15px}
    
    .header{
      text-align:center;
      padding:20px 0 15px;
      border-bottom:1px solid rgba(255,255,255,0.05);
      margin-bottom:20px;
      position: relative;
    }
    
    .logo{
      display:flex;
      align-items:center;
      justify-content:center;
      margin-bottom:15px;
    }
    
    .logo-icon{
      font-size:32px;
      color:var(--accent);
      margin-right:12px;
      text-shadow:0 0 15px var(--accent-glow);
      animation:pulse 3s infinite;
    }
    
    .logo-text{
      font-family:'Orbitron',sans-serif;
      font-size:36px;
      font-weight:800;
      background:linear-gradient(90deg,#fff,var(--accent));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      letter-spacing: 1px;
    }
    
    .tagline{
      font-size:16px;
      color:var(--text-secondary);
      margin-bottom:5px;
      font-weight: 600;
    }
    
    .version{
      font-size:11px;
      color:var(--text-secondary);
      background:var(--secondary);
      padding:3px 10px;
      border-radius:12px;
      display:inline-block;
      margin-top:8px;
      border:1px solid var(--border);
    }
    
    .live-indicator {
      display:inline-flex;
      align-items:center;
      background:rgba(0,255,149,0.2);
      color:var(--buy);
      padding:4px 12px;
      border-radius:12px;
      font-size:12px;
      margin-left:10px;
      animation:blink 2s infinite;
    }
    
    .live-indicator::before {
      content:'';
      width:8px;
      height:8px;
      background:var(--buy);
      border-radius:50%;
      margin-right:6px;
      animation:blink 2s infinite;
    }

    .dashboard{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:15px;
      margin:20px 0;
    }
    
    .metric-card{
      background:var(--card-bg);
      border-radius:16px;
      padding:18px;
      text-align:center;
      border:1px solid var(--border);
      box-shadow:0 8px 24px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
    }
    
    .metric-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), var(--buy));
    }
    
    .metric-value{
      font-size:24px;
      font-weight:700;
      margin:8px 0;
      color:var(--accent);
      font-family:'Orbitron',sans-serif;
    }
    
    .metric-label{
      font-size:13px;
      color:var(--text-secondary);
      font-weight:600;
    }
    
    .metric-change.positive {
      color: var(--buy);
      font-size: 12px;
      font-weight: 600;
    }

    .signal-section{
      background:var(--card-bg);
      border-radius:20px;
      padding:0;
      margin:25px 0;
      border:1px solid var(--border);
      box-shadow:0 10px 30px rgba(0,0,0,0.4);
      overflow:hidden;
    }
    
    .signal-header{
      background:linear-gradient(90deg,var(--secondary),rgba(0,247,255,0.1));
      padding:18px 25px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid var(--border);
    }
    
    .signal-body{
      padding:25px;
    }
    
    .signal-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
    }
    
    .signal-title i {
      margin-right: 10px;
      color: var(--accent);
    }
    
    .signal-timer {
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      background: rgba(0, 247, 255, 0.1);
      padding: 6px 12px;
      border-radius: 10px;
      border: 1px solid rgba(0, 247, 255, 0.3);
    }
    
    .signal-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 22px;
      box-shadow: 0 0 20px rgba(0, 247, 255, 0.3);
    }
    
    .signal-icon.buy {
      background: var(--signal-buy);
      color: var(--buy);
    }
    
    .signal-icon.sell {
      background: var(--signal-sell);
      color: var(--sell);
    }
    
    .signal-icon.otc {
      background: rgba(255, 165, 0, 0.15);
      color: var(--otc-color);
      box-shadow: 0 0 20px rgba(255, 165, 0, 0.3);
    }
    
    .signal-text {
      font-size: 28px;
      font-weight: 800;
      font-family: 'Orbitron', sans-serif;
    }
    
    .signal-text.buy {
      color: var(--buy);
      text-shadow: 0 0 15px rgba(0, 255, 149, 0.4);
    }
    
    .signal-text.sell {
      color: var(--sell);
      text-shadow: 0 0 15px rgba(255, 46, 76, 0.4);
    }
    
    .signal-text.otc {
      color: var(--otc-color);
      text-shadow: 0 0 15px rgba(255, 165, 0, 0.4);
    }

    .upload-section{
      background:var(--card-bg);
      border-radius:20px;
      padding:25px;
      margin:25px 0;
      border:1px solid var(--border);
      box-shadow:0 10px 30px rgba(0,0,0,0.4);
    }
    
    .section-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
    }
    
    .section-title i {
      margin-right: 10px;
      color: var(--accent);
    }
    
    .chart-preview{
      width:100%;
      height:240px;
      background:var(--secondary);
      border-radius:16px;
      margin:20px 0;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      position:relative;
      border:1px solid var(--border);
    }
    
    .chart-preview img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;
    }
    
    .chart-overlay{
      position:absolute;
      inset:0;
      pointer-events:none;
    }

    /* Advanced Annotation Styles */
    .chart-annotation {
      position: absolute;
      pointer-events: none;
      z-index: 100;
    }
    
    .support-line {
      position: absolute;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--buy), transparent);
      box-shadow: 0 0 10px var(--buy);
    }
    
    .resistance-line {
      position: absolute;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--sell), transparent);
      box-shadow: 0 0 10px var(--sell);
    }
    
    .level-label {
      position: absolute;
      background: rgba(0,0,0,0.8);
      color: var(--text);
      padding: 3px 8px;
      border-radius: 5px;
      font-size: 10px;
      font-weight: 700;
      left: 5px;
      transform: translateY(-50%);
      border: 1px solid;
      z-index: 101;
    }
    
    .support-label {
      border-color: var(--buy);
      background: rgba(0, 255, 149, 0.1);
    }
    
    .resistance-label {
      border-color: var(--sell);
      background: rgba(255, 46, 76, 0.1);
    }
    
    .candle-highlight {
      position: absolute;
      border: 2px solid;
      border-radius: 4px;
      pointer-events: none;
      z-index: 99;
    }
    
    .candle-bullish {
      border-color: var(--buy);
      background: rgba(0, 255, 149, 0.1);
      box-shadow: 0 0 15px rgba(0, 255, 149, 0.3);
    }
    
    .candle-bearish {
      border-color: var(--sell);
      background: rgba(255, 46, 76, 0.1);
      box-shadow: 0 0 15px rgba(255, 46, 76, 0.3);
    }
    
    .candle-neutral {
      border-color: var(--otc-color);
      background: rgba(255, 165, 0, 0.1);
      box-shadow: 0 0 15px rgba(255, 165, 0, 0.3);
    }
    
    .pattern-marker {
      position: absolute;
      background: rgba(0,0,0,0.9);
      color: var(--text);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 700;
      border: 1px solid;
      z-index: 102;
    }
    
    .pattern-bullish {
      border-color: var(--buy);
      background: rgba(0, 255, 149, 0.2);
    }
    
    .pattern-bearish {
      border-color: var(--sell);
      background: rgba(255, 46, 76, 0.2);
    }
    
    .breakout-marker {
      position: absolute;
      background: rgba(255, 0, 255, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 700;
      border: 2px dashed var(--pattern-color);
      z-index: 103;
      animation: pulse 2s infinite;
    }
    
    .bos-marker {
      position: absolute;
      background: rgba(0, 247, 255, 0.9);
      color: black;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 700;
      border: 2px solid var(--accent);
      z-index: 103;
    }
    
    .trend-line {
      position: absolute;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), transparent);
      transform-origin: left center;
      z-index: 98;
    }
    
    .volume-zone {
      position: absolute;
      background: rgba(255, 165, 0, 0.2);
      border: 1px dashed var(--otc-color);
      z-index: 97;
    }
    
    .annotation-legend {
      position: absolute;
      bottom: 5px;
      right: 5px;
      background: rgba(0,0,0,0.8);
      padding: 8px;
      border-radius: 6px;
      font-size: 9px;
      z-index: 104;
      border: 1px solid var(--border);
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    
    .legend-color {
      width: 12px;
      height: 3px;
      margin-right: 6px;
    }

    .detected-box{
      position:absolute;
      border:2px dashed rgba(0,247,255,0.6);
      border-radius:6px;
      padding:4px;
      font-size:12px;
      font-weight:700;
      color:var(--accent);
      background:linear-gradient(180deg,rgba(0,0,0,0.25),transparent);
      backdrop-filter:blur(2px);
    }
    
    .detected-box.otc {
      border-color: rgba(255, 165, 0, 0.6);
      color: var(--otc-color);
    }
    
    .detected-box.buy, .detected-box.bullish {
      border-color: rgba(0, 255, 149, 0.6);
      color: var(--buy);
    }
    
    .detected-box.sell, .detected-box.bearish {
      border-color: rgba(255, 46, 76, 0.6);
      color: var(--sell);
    }
    
    .detected-box.pattern, .detected-box.neutral {
      border-color: rgba(255, 0, 255, 0.6);
      color: var(--pattern-color);
    }

    .vision-panel{
      background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      border-radius:12px;
      padding:12px;
      border:1px solid var(--border);
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    
    .select{
      background:rgba(26,36,63,0.5);
      border:1px solid var(--border);
      padding:8px 10px;
      border-radius:8px;
      color:var(--text);
      font-weight:600;
    }
    
    .btn{
      background:linear-gradient(90deg,var(--accent),#00b8ff);
      padding:8px 12px;
      border-radius:8px;
      border:none;
      color:#001;
      cursor:pointer;
      font-weight:800;
      transition: all 0.3s ease;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 247, 255, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:8px;
      color:var(--text-secondary);
    }
    
    .upload-option {
      cursor: pointer;
      border: 2px dashed var(--border);
      padding: 14px;
      border-radius: 10px;
      text-align: center;
      background: rgba(26,36,63,0.5);
      transition: all 0.3s ease;
    }
    
    .upload-option:hover {
      border-color: var(--accent);
      background: rgba(0, 247, 255, 0.05);
      transform: translateY(-3px);
    }

    .vision-results{
      margin-top:12px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    
    .result-card{
      background:rgba(26,36,63,0.6);
      padding:10px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:13px;
    }
    
    .confidence-bar {
      height: 6px;
      background: var(--secondary);
      border-radius: 3px;
      margin-top: 8px;
      overflow: hidden;
      position: relative;
    }
    
    .confidence-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 1.5s ease;
      position: relative;
      box-shadow: 0 0 10px rgba(0, 247, 255, 0.3);
    }
    
    .confidence-fill.high {
      background: linear-gradient(90deg, var(--buy), #00ff80);
    }
    
    .confidence-fill.medium {
      background: linear-gradient(90deg, var(--otc-color), #ffcc66);
    }
    
    .confidence-fill.low {
      background: linear-gradient(90deg, #ff2e4c, #ff6b8b);
    }
    
    .analysis-details {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    
    .details-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .tab {
      padding: 10px 15px;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .tab.active {
      color: var(--accent);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .indicator-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .indicator-name {
      font-weight: 600;
    }
    
    .indicator-value {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
    }
    
    .pattern-item {
      display: flex;
      align-items: center;
      padding: 12px;
      margin-bottom: 10px;
      background: rgba(26,36,63,0.6);
      border-radius: 10px;
      border: 1px solid var(--border);
    }
    
    .pattern-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 18px;
    }
    
    .pattern-icon.bullish {
      background: var(--signal-buy);
      color: var(--buy);
    }
    
    .pattern-icon.bearish {
      background: var(--signal-sell);
      color: var(--sell);
    }
    
    .pattern-icon.neutral {
      background: rgba(255, 165, 0, 0.15);
      color: var(--otc-color);
    }
    
    .pattern-details {
      flex: 1;
    }
    
    .pattern-name {
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .pattern-confidence {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .pattern-strength {
      width: 80px;
      text-align: right;
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
    }
    
    .strategy-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 15px 0;
    }
    
    .strategy-card {
      background: rgba(26,36,63,0.6);
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
    }
    
    .strategy-card.active {
      border-color: var(--accent);
      background: rgba(0, 247, 255, 0.1);
      box-shadow: 0 0 15px rgba(0, 247, 255, 0.2);
    }
    
    .strategy-name {
      font-weight: 700;
      font-size: 13px;
      margin-bottom: 5px;
      color: var(--accent);
    }
    
    .strategy-rate {
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      font-weight: 700;
      color: var(--buy);
    }
    
    .key-levels {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    
    .level-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 10px;
      background: rgba(26,36,63,0.6);
      border-radius: 10px;
      border-left: 3px solid;
    }
    
    .level-item.support {
      border-left-color: var(--buy);
    }
    
    .level-item.resistance {
      border-left-color: var(--sell);
    }
    
    .level-label {
      font-weight: 700;
    }
    
    .level-price {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 16px;
    }
    
    .level-distance {
      font-size: 11px;
      color: var(--text-secondary);
    }
    
    .logic-box {
      background: linear-gradient(135deg, rgba(0, 247, 255, 0.1), rgba(0, 255, 149, 0.1));
      border: 2px solid var(--accent);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .logic-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
    }
    
    .logic-title i {
      margin-right: 8px;
    }
    
    .logic-point {
      display: flex;
      align-items: flex-start;
      margin-bottom: 10px;
      padding-left: 25px;
      position: relative;
    }
    
    .logic-point::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: var(--buy);
      font-weight: 700;
      font-size: 18px;
    }
    
    .candle-analysis {
      background: rgba(26,36,63,0.8);
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
      border: 1px solid var(--border);
    }
    
    .candle-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }
    
    .candle-stat {
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }
    
    .candle-stat-label {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 5px;
    }
    
    .candle-stat-value {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 14px;
    }

    .entry-timer {
      background: linear-gradient(90deg, var(--buy), #00ff80);
      color: #000;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin: 15px 0;
      font-family: 'Orbitron', sans-serif;
    }
    
    .entry-timer-label {
      font-size: 12px;
      font-weight: 600;
      opacity: 0.8;
    }
    
    .entry-timer-value {
      font-size: 24px;
      font-weight: 800;
      margin: 5px 0;
    }
    
    .entry-timer-action {
      font-size: 16px;
      font-weight: 700;
    }
    
    .psychology-tip {
      background: rgba(255, 165, 0, 0.1);
      border-left: 3px solid var(--otc-color);
      padding: 12px 15px;
      border-radius: 8px;
      margin: 15px 0;
    }
    
    .psychology-tip-title {
      font-weight: 700;
      color: var(--otc-color);
      margin-bottom: 5px;
      font-size: 13px;
    }
    
    .psychology-tip-text {
      font-size: 12px;
      line-height: 1.5;
    }
    
    .win-tracker {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 5px;
      margin: 15px 0;
    }
    
    .win-dot {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 50%;
      border: 2px solid var(--border);
    }
    
    .win-dot.win {
      background: var(--buy);
      border-color: var(--buy);
      box-shadow: 0 0 8px rgba(0, 255, 149, 0.5);
    }
    
    .win-dot.loss {
      background: var(--sell);
      border-color: var(--sell);
      box-shadow: 0 0 8px rgba(255, 46, 76, 0.5);
    }
    
    .api-config {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    
    .api-input-group {
      margin-bottom: 15px;
    }
    
    .api-input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .api-input {
      width: 100%;
      padding: 10px;
      background: rgba(26,36,63,0.5);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
    }
    
    .api-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(0, 247, 255, 0.2);
    }
    
    .api-status {
      display: flex;
      align-items: center;
      margin-top: 10px;
      font-size: 14px;
    }
    
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-indicator.connected {
      background: var(--buy);
      box-shadow: 0 0 10px rgba(0, 255, 149, 0.5);
    }
    
    .status-indicator.disconnected {
      background: var(--sell);
      box-shadow: 0 0 10px rgba(255, 46, 76, 0.5);
    }
    
    .status-indicator.connecting {
      background: var(--otc-color);
      box-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
      animation: pulse 1.5s infinite;
    }

    .notification{
      position:fixed;
      bottom:25px;
      left:50%;
      transform:translateX(-50%);
      background:var(--card-bg);
      padding:15px 25px;
      border-radius:12px;
      box-shadow:0 10px 25px rgba(0,0,0,0.5);
      display:flex;
      align-items:center;
      z-index:1000;
      opacity:0;
      transition:opacity .3s;
      border: 1px solid var(--border);
      max-width: 90%;
    }
    
    .notification.show{
      opacity:1;
    }

    .muted{color:var(--text-secondary);font-size:12px}
    
    .footer {
      text-align: center;
      padding: 25px 0;
      font-size: 14px;
      color: var(--text-secondary);
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      margin-top: 20px;
    }
    
    .contact {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .owner {
      margin-left: 15px;
      padding: 4px 10px;
      background: rgba(0, 247, 255, 0.1);
      border-radius: 10px;
      font-size: 12px;
      border: 1px solid rgba(0, 247, 255, 0.2);
    }
    
    .progress-bar {
      height: 4px;
      background: var(--secondary);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 10px;
      display: none;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--buy));
      border-radius: 2px;
      width: 0%;
      transition: width 0.3s ease;
    }

    .market-type {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      margin-left: 10px;
    }
    
    .market-type.otc {
      background: rgba(255, 165, 0, 0.15);
      color: var(--otc-color);
      border: 1px solid rgba(255, 165, 0, 0.3);
    }
    
    .market-type.real {
      background: rgba(0, 255, 149, 0.15);
      color: var(--buy);
      border: 1px solid rgba(0, 255, 149, 0.3);
    }
    
    .sure-shot-indicator {
      display: inline-flex;
      align-items: center;
      background: rgba(0, 255, 149, 0.2);
      color: var(--buy);
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      margin-left: 10px;
      animation: pulse 2s infinite;
    }
    
    .sure-shot-indicator i {
      margin-right: 5px;
    }
    
    .confidence-level {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      margin-left: 8px;
    }
    
    .confidence-level.high {
      background: rgba(0, 255, 149, 0.15);
      color: var(--high-confidence);
    }
    
    .confidence-level.medium {
      background: rgba(255, 165, 0, 0.15);
      color: var(--medium-confidence);
    }
    
    .confidence-level.low {
      background: rgba(255, 46, 76, 0.15);
      color: var(--low-confidence);
    }
    
    .signal-strength {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    
    .strength-bar {
      flex: 1;
      height: 6px;
      background: var(--secondary);
      border-radius: 3px;
      overflow: hidden;
      margin-right: 10px;
    }
    
    .strength-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.5s ease;
    }
    
    .strength-fill.high {
      background: linear-gradient(90deg, var(--buy), #00ff80);
      width: 90%;
    }
    
    .strength-fill.medium {
      background: linear-gradient(90deg, var(--otc-color), #ffcc66);
      width: 70%;
    }
    
    .strength-fill.low {
      background: linear-gradient(90deg, #ff2e4c, #ff6b8b);
      width: 50%;
    }

    .next-candle-prediction {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    
    .prediction-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .prediction-title {
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
    }
    
    .prediction-title i {
      margin-right: 10px;
      color: var(--accent);
    }
    
    .prediction-confidence {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      color: var(--accent);
      background: rgba(0, 247, 255, 0.1);
      padding: 6px 12px;
      border-radius: 10px;
      border: 1px solid rgba(0, 247, 255, 0.3);
    }
    
    .candle-preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .candle-container {
      width: 100%;
      height: 120px;
      position: relative;
      background: var(--secondary);
      border-radius: 10px;
      border: 1px solid var(--border);
      margin-bottom: 15px;
      overflow: hidden;
    }
    
    .candle-chart {
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    .predicted-candle {
      position: absolute;
      width: 30px;
      background: var(--buy);
      border-radius: 4px;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      transition: all 1s ease;
      box-shadow: 0 0 15px rgba(0, 255, 149, 0.4);
    }
    
    .predicted-candle.bearish {
      background: var(--sell);
      box-shadow: 0 0 15px rgba(255, 46, 76, 0.4);
    }
    
    .predicted-candle.neutral {
      background: var(--otc-color);
      box-shadow: 0 0 15px rgba(255, 165, 0, 0.4);
    }
    
    .candle-wick {
      position: absolute;
      width: 2px;
      background: var(--text);
      left: 50%;
      transform: translateX(-50%);
    }
    
    .candle-wick.upper {
      top: 10px;
    }
    
    .candle-wick.lower {
      bottom: 10px;
    }
    
    .prediction-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }
    
    .prediction-card {
      background: rgba(26,36,63,0.6);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid var(--border);
    }
    
    .prediction-card-title {
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--accent);
    }
    
    .prediction-value {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 18px;
    }
    
    .prediction-value.bullish {
      color: var(--buy);
    }
    
    .prediction-value.bearish {
      color: var(--sell);
    }
    
    .prediction-value.neutral {
      color: var(--otc-color);
    }
    
    .prediction-description {
      margin-top: 15px;
      padding: 15px;
      background: rgba(26,36,63,0.6);
      border-radius: 10px;
      border: 1px solid var(--border);
      line-height: 1.5;
    }

    @keyframes pulse{
      0%{transform:scale(1);opacity:1}
      50%{transform:scale(1.05);opacity:.8}
      100%{transform:scale(1);opacity:1}
    }
    
    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    @keyframes success-glow {
      0% { box-shadow: 0 0 5px rgba(0, 255, 149, 0.5); }
      50% { box-shadow: 0 0 20px rgba(0, 255, 149, 0.8); }
      100% { box-shadow: 0 0 5px rgba(0, 255, 149, 0.5); }
    }
    
    @keyframes candle-grow {
      0% { height: 0; }
      100% { height: var(--final-height); }
    }
    
    @media(max-width:480px){
      .dashboard{grid-template-columns:1fr}
      .vision-results{grid-template-columns:1fr}
      .logo-text{font-size:30px}
      .prediction-details{grid-template-columns:1fr}
      .strategy-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <div class="logo-icon"><i class="fas fa-robot"></i></div>
        <div class="logo-text">MAHIR X FALCON AI</div>
        <div class="live-indicator">LIVE</div>
      </div>
      <div class="tagline">REAL-TIME BINARY OPTIONS • QUOTEX OPTIMIZED • 1-MINUTE SIGNALS</div>
      <div class="version">v8.0 | GEMINI-POWERED CHART VISION SYSTEM</div>
    </div>

    <div class="dashboard">
      <div class="metric-card">
        <div class="metric-label">LIVE TIME (BDT)</div>
        <div class="metric-value" id="bdtTime">--:--:--</div>
        <div class="metric-change positive" id="bdtDate">Loading...</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">NEXT ENTRY</div>
        <div class="metric-value" id="nextEntry">--:--</div>
        <div class="metric-change positive">1 MIN EXPIRY</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">WIN RATE</div>
        <div class="metric-value" id="winRate">--%</div>
        <div class="metric-change positive">Real-time tracking</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">SIGNALS TODAY</div>
        <div class="metric-value" id="signalsToday">0</div>
        <div class="metric-change positive" id="winsToday">0 Wins</div>
      </div>
    </div>

    <!-- API CONFIGURATION SECTION -->
    <div class="api-config">
      <div class="section-title"><i class="fas fa-key"></i> GEMINI API CONFIGURATION</div>
      
      <div class="api-input-group">
        <label for="apiKeyInput">API Key (Get free at ai.google.dev)</label>
        <input type="password" id="apiKeyInput" class="api-input" placeholder="Enter your Gemini API key" value="AIzaSyBzu3LX9gsKcmC1oZdUEbvygRYLhjvrA9A">
      </div>
      
      <div class="api-input-group">
        <label for="modelSelect">Model</label>
        <select id="modelSelect" class="api-input">
          <option value="gemini-1.5-flash">Gemini 1.5 Flash (Recommended)</option>
          <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
          <option value="gemini-pro-vision">Gemini Pro Vision</option>
        </select>
      </div>
      
      <button class="btn" id="connectApiBtn" style="width: 100%; margin-top: 10px;">
        <i class="fas fa-plug"></i> Connect to Gemini
      </button>
      
      <div class="api-status">
        <div class="status-indicator disconnected" id="statusIndicator"></div>
        <span id="statusText">Not connected - Enter API key above</span>
      </div>
    </div>

    <!-- SIGNAL SECTION -->
    <div class="signal-section">
      <div class="signal-header">
        <div class="signal-title"><i class="fas fa-brain"></i> AI SIGNAL</div>
        <div class="signal-timer" id="signalTimer">READY</div>
      </div>
      <div class="signal-body">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
          <div style="display:flex;gap:12px;align-items:center">
            <div class="signal-icon" id="signalIcon" style="width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:50%">
              <i class="fas fa-chart-line"></i>
            </div>
            <div>
              <div style="display:flex;align-items:center;flex-wrap:wrap">
                <div class="signal-text" id="signalText" style="font-size:18px">ANALYZE</div>
                <div class="sure-shot-indicator" id="sureShotIndicator" style="display:none">
                  <i class="fas fa-bullseye"></i> SURE SHOT
                </div>
              </div>
              <div style="display:flex;align-items:center;margin-top:5px;flex-wrap:wrap">
                <div class="muted" id="signalPair">READY FOR ANALYSIS</div>
                <div class="market-type" id="marketType" style="display:none">OTC</div>
              </div>
            </div>
          </div>
          <div style="text-align:right">
            <div style="font-weight:800;font-family:'Orbitron',sans-serif;font-size:20px;color:var(--accent)" id="signalConfidence">--%</div>
            <div class="muted">CONFIDENCE</div>
          </div>
        </div>
        
        <div class="signal-strength" id="signalStrength" style="display:none">
          <div class="strength-bar">
            <div class="strength-fill high" id="strengthFill"></div>
          </div>
          <div class="confidence-level high" id="strengthText">HIGH STRENGTH</div>
        </div>
        
        <div class="progress-bar" id="analysisProgressBar">
          <div class="progress-fill" id="analysisProgressFill"></div>
        </div>
      </div>
    </div>

    <!-- NEXT CANDLE PREDICTION SECTION -->
    <div class="next-candle-prediction" id="nextCandlePrediction" style="display: none;">
      <div class="prediction-header">
        <div class="prediction-title"><i class="fas fa-crystal-ball"></i> NEXT CANDLE PREDICTION</div>
        <div class="prediction-confidence" id="predictionConfidence">--%</div>
      </div>
      
      <div class="candle-preview">
        <div class="candle-container">
          <div class="candle-chart" id="candleChart">
            <!-- Predicted candle will be drawn here -->
          </div>
        </div>
        <div class="muted">PREDICTED NEXT CANDLE MOVEMENT</div>
      </div>
      
      <div class="prediction-details">
        <div class="prediction-card">
          <div class="prediction-card-title">DIRECTION</div>
          <div class="prediction-value" id="predictionDirection">--</div>
        </div>
        <div class="prediction-card">
          <div class="prediction-card-title">EXPECTED MOVE</div>
          <div class="prediction-value" id="predictionMove">-- pips</div>
        </div>
      </div>
      
      <div class="prediction-description" id="predictionDescription">
        Upload a chart to get next candle prediction
      </div>
    </div>

    <!-- UPLOAD + GEMINI AI VISION PANEL -->
    <div class="upload-section">
      <div class="section-title"><i class="fas fa-camera"></i> UPLOAD CHART — GEMINI AI VISION</div>

      <div class="vision-panel">
        <div style="display:flex;gap:8px;align-items:center;flex:1;flex-wrap:wrap">
          <div class="muted">Market:</div>
          <select id="marketSelect" class="select">
            <option>EUR/USD</option>
            <option>GBP/USD</option>
            <option>USD/JPY</option>
            <option>AUD/USD</option>
            <option>XAU/USD (Gold)</option>
            <option selected>OTC Pairs</option>
            <option>BTC/USD</option>
            <option>ETH/USD</option>
          </select>
        </div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <label class="toggle"><input type="checkbox" id="otcToggle" checked> OTC</label>
          <button class="btn" id="analyzeBtn"><i class="fas fa-brain"></i> Analyze</button>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <div class="upload-option" onclick="document.getElementById('fileInput').click()" style="flex:1;cursor:pointer;padding:14px;text-align:center">
          <i class="fas fa-cloud-upload-alt" style="color:var(--accent);font-size:22px"></i>
          <div style="font-weight:700;margin-top:6px">Upload Chart</div>
          <div class="muted">Click or drag chart image</div>
          <input type="file" id="fileInput" accept="image/*" style="display:none">
        </div>
        <div class="upload-option" id="pasteBox" style="width:86px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:12px;cursor:pointer">
          <i class="fas fa-paste" style="color:var(--accent);font-size:18px"></i>
          <div class="muted" style="font-size:11px;margin-top:6px">Paste</div>
        </div>
      </div>

      <div class="chart-preview" id="chartPreview">
        <div class="chart-placeholder" id="chartPlaceholder">
          <i class="fas fa-chart-candlestick" style="font-size:48px;color:var(--accent)"></i>
          <div class="muted" style="margin-top:6px">Trading chart preview</div>
        </div>
        <div class="chart-overlay" id="chartOverlay" aria-hidden="true"></div>
      </div>

      <div class="vision-results" id="visionResults">
        <div class="result-card">
          <div style="font-weight:800">GEMINI AI SUMMARY</div>
          <div id="aiSummary" class="muted" style="margin-top:8px">Upload chart for Gemini analysis</div>
          <div class="confidence-bar">
            <div class="confidence-fill" id="summaryConfidence" style="width: 0%"></div>
          </div>
        </div>
        <div class="result-card">
          <div style="font-weight:800">DETECTED PATTERNS</div>
          <div id="detectedSignals" class="muted" style="margin-top:8px">—</div>
          <div class="confidence-bar">
            <div class="confidence-fill" id="signalsConfidence" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ANALYSIS DETAILS SECTION -->
    <div class="analysis-details" id="analysisDetails" style="display: none;">
      <div class="section-title"><i class="fas fa-chart-pie"></i> DETAILED ANALYSIS</div>
      
      <div class="details-tabs">
        <div class="tab active" data-tab="indicators">Indicators</div>
        <div class="tab" data-tab="patterns">Patterns</div>
        <div class="tab" data-tab="levels">Levels</div>
        <div class="tab" data-tab="gemini">Gemini AI</div>
      </div>
      
      <div class="tab-content active" id="indicators-tab">
        <div id="indicatorsContent">
          <!-- Technical indicators will be populated here -->
        </div>
      </div>
      
      <div class="tab-content" id="patterns-tab">
        <div id="patternsContent">
          <!-- Chart patterns will be populated here -->
        </div>
      </div>
      
      <div class="tab-content" id="levels-tab">
        <div id="levelsContent">
          <!-- Support/Resistance levels will be populated here -->
        </div>
      </div>
      
      <div class="tab-content" id="gemini-tab">
        <div id="geminiContent">
          <!-- Gemini AI insights will be populated here -->
        </div>
      </div>
    </div>

    <div class="footer">
      <div>MAHIR X FALCON AI PROFESSIONAL BINARY TRADING SYSTEM</div>
      <div class="contact" style="margin-top:10px;text-align:center">
        <a href="https://t.me/LUX_DOT" target="_blank" style="color:var(--accent);text-decoration:none;font-weight:700"><i class="fab fa-telegram"></i> @LUX_DOT</a>
        <div class="owner">DEVELOPED BY MAHIR</div>
      </div>
      <div class="muted" style="margin-top:10px;font-size:12px">
        &copy; 2024 MAHIR X FALCON AI. Real Gemini Vision Integration.
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-check-circle" style="margin-right:10px;color:var(--accent)"></i>
    <span id="notificationText">Ready</span>
  </div>

  <!-- Hidden canvas for image processing -->
  <canvas id="imageCanvas" style="display: none;"></canvas>

  <script>
    // Application state
    const appState = {
      apiKey: '',
      isApiConnected: false,
      currentChartImage: null,
      analysisResults: null,
      winHistory: [],
      signalHistory: [],
      isAnalyzing: false,
      chartAnnotations: []
    };

    // DOM elements
    const elements = {
      // Time elements
      bdtTime: document.getElementById('bdtTime'),
      bdtDate: document.getElementById('bdtDate'),
      nextEntry: document.getElementById('nextEntry'),
      
      // API elements
      apiKeyInput: document.getElementById('apiKeyInput'),
      modelSelect: document.getElementById('modelSelect'),
      connectApiBtn: document.getElementById('connectApiBtn'),
      statusIndicator: document.getElementById('statusIndicator'),
      statusText: document.getElementById('statusText'),
      
      // Signal elements
      signalTimer: document.getElementById('signalTimer'),
      signalIcon: document.getElementById('signalIcon'),
      signalText: document.getElementById('signalText'),
      signalPair: document.getElementById('signalPair'),
      signalConfidence: document.getElementById('signalConfidence'),
      signalStrength: document.getElementById('signalStrength'),
      strengthFill: document.getElementById('strengthFill'),
      strengthText: document.getElementById('strengthText'),
      sureShotIndicator: document.getElementById('sureShotIndicator'),
      marketType: document.getElementById('marketType'),
      analysisProgressBar: document.getElementById('analysisProgressBar'),
      analysisProgressFill: document.getElementById('analysisProgressFill'),
      
      // Upload elements
      fileInput: document.getElementById('fileInput'),
      pasteBox: document.getElementById('pasteBox'),
      chartPreview: document.getElementById('chartPreview'),
      chartPlaceholder: document.getElementById('chartPlaceholder'),
      chartOverlay: document.getElementById('chartOverlay'),
      analyzeBtn: document.getElementById('analyzeBtn'),
      marketSelect: document.getElementById('marketSelect'),
      otcToggle: document.getElementById('otcToggle'),
      
      // Results elements
      aiSummary: document.getElementById('aiSummary'),
      detectedSignals: document.getElementById('detectedSignals'),
      summaryConfidence: document.getElementById('summaryConfidence'),
      signalsConfidence: document.getElementById('signalsConfidence'),
      
      // Next candle prediction
      nextCandlePrediction: document.getElementById('nextCandlePrediction'),
      predictionConfidence: document.getElementById('predictionConfidence'),
      predictionDirection: document.getElementById('predictionDirection'),
      predictionMove: document.getElementById('predictionMove'),
      predictionDescription: document.getElementById('predictionDescription'),
      candleChart: document.getElementById('candleChart'),
      
      // Analysis details
      analysisDetails: document.getElementById('analysisDetails'),
      indicatorsContent: document.getElementById('indicatorsContent'),
      patternsContent: document.getElementById('patternsContent'),
      levelsContent: document.getElementById('levelsContent'),
      geminiContent: document.getElementById('geminiContent'),
      
      // Stats elements
      winRate: document.getElementById('winRate'),
      signalsToday: document.getElementById('signalsToday'),
      winsToday: document.getElementById('winsToday'),
      
      // Notification
      notification: document.getElementById('notification'),
      notificationText: document.getElementById('notificationText')
    };

    // Initialize the application
    function init() {
      setupEventListeners();
      updateTime();
      updateNextEntryTimer();
      updateStats();
      setInterval(updateTime, 1000);
      setInterval(updateNextEntryTimer, 1000);
      setInterval(updateStats, 30000);
      
      // Load any saved state
      loadSavedState();
      
      showNotification('MAHIR X FALCON AI initialized successfully');
    }

    // Set up event listeners
    function setupEventListeners() {
      // API connection
      elements.connectApiBtn.addEventListener('click', connectToGemini);
      
      // File upload
      elements.fileInput.addEventListener('change', handleFileUpload);
      
      // Paste functionality
      elements.pasteBox.addEventListener('click', handlePaste);
      document.addEventListener('paste', handleGlobalPaste);
      
      // Analyze button
      elements.analyzeBtn.addEventListener('click', analyzeChart);
      
      // Tab switching
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', switchTab);
      });
      
      // OTC toggle
      elements.otcToggle.addEventListener('change', updateMarketType);
    }

    // Update Bangladesh time
    function updateTime() {
      const now = new Date();
      const bdtTime = new Date(now.getTime() + (6 * 60 * 60 * 1000)); // UTC+6 for BDT
      
      const timeString = bdtTime.toLocaleTimeString('en-US', { 
        hour12: false,
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      
      const dateString = bdtTime.toLocaleDateString('en-US', {
        weekday: 'short',
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
      
      elements.bdtTime.textContent = timeString;
      elements.bdtDate.textContent = dateString;
    }

    // Update next entry timer
    function updateNextEntryTimer() {
      const now = new Date();
      const seconds = now.getSeconds();
      const nextMinute = 60 - seconds;
      
      elements.nextEntry.textContent = `00:${nextMinute.toString().padStart(2, '0')}`;
      elements.signalTimer.textContent = `00:${nextMinute.toString().padStart(2, '0')}`;
      
      // Auto-refresh analysis when timer resets
      if (nextMinute === 60 && appState.currentChartImage && !appState.isAnalyzing) {
        analyzeChart();
      }
    }

    // Update statistics
    function updateStats() {
      // Calculate win rate
      if (appState.winHistory.length > 0) {
        const wins = appState.winHistory.filter(win => win).length;
        const winRate = Math.round((wins / appState.winHistory.length) * 100);
        elements.winRate.textContent = `${winRate}%`;
      } else {
        elements.winRate.textContent = '--%';
      }
      
      // Update today's signals
      const today = new Date().toDateString();
      const todaySignals = appState.signalHistory.filter(signal => 
        new Date(signal.timestamp).toDateString() === today
      );
      
      elements.signalsToday.textContent = todaySignals.length;
      
      const todayWins = todaySignals.filter(signal => signal.result === 'win').length;
      elements.winsToday.textContent = `${todayWins} Wins`;
    }

    // Connect to Gemini API - FIXED VERSION
    async function connectToGemini() {
      const apiKey = elements.apiKeyInput.value.trim();
      
      if (!apiKey) {
        showNotification('Please enter your Gemini API key');
        return;
      }
      
      appState.apiKey = apiKey;
      
      // Update UI to show connecting state
      elements.statusIndicator.className = 'status-indicator connecting';
      elements.statusText.textContent = 'Connecting to Gemini API...';
      elements.connectApiBtn.disabled = true;
      
      try {
        // Test the API key with a simple request using the correct endpoint
        const response = await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${apiKey}`);
        
        if (response.ok) {
          // Connection successful
          appState.isApiConnected = true;
          elements.statusIndicator.className = 'status-indicator connected';
          elements.statusText.textContent = 'Connected to Gemini API';
          showNotification('Successfully connected to Gemini API');
          
          // Save API key to localStorage
          localStorage.setItem('mahirFalconApiKey', apiKey);
        } else {
          throw new Error('API key invalid');
        }
      } catch (error) {
        // Connection failed
        appState.isApiConnected = false;
        elements.statusIndicator.className = 'status-indicator disconnected';
        elements.statusText.textContent = 'Connection failed - Check API key';
        showNotification('Failed to connect to Gemini API. Check your API key and try again.');
        console.error('Gemini API connection error:', error);
      }
      
      elements.connectApiBtn.disabled = false;
    }

    // Handle file upload
    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.match('image.*')) {
        showNotification('Please upload an image file');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        displayChartImage(e.target.result);
      };
      reader.readAsDataURL(file);
    }

    // Handle paste from clipboard
    function handlePaste() {
      navigator.clipboard.read().then(clipboardItems => {
        for (const clipboardItem of clipboardItems) {
          for (const type of clipboardItem.types) {
            if (type.startsWith('image/')) {
              clipboardItem.getType(type).then(blob => {
                const reader = new FileReader();
                reader.onload = function(e) {
                  displayChartImage(e.target.result);
                };
                reader.readAsDataURL(blob);
              });
              return;
            }
          }
        }
        showNotification('No image found in clipboard');
      }).catch(err => {
        console.error('Failed to read clipboard:', err);
        showNotification('Clipboard access denied. Please use the upload option.');
      });
    }

    // Handle global paste event
    function handleGlobalPaste(event) {
      const items = event.clipboardData.items;
      for (let i = 0; i < items.length; i++) {
        if (items[i].type.indexOf('image') !== -1) {
          const blob = items[i].getAsFile();
          const reader = new FileReader();
          reader.onload = function(e) {
            displayChartImage(e.target.result);
          };
          reader.readAsDataURL(blob);
          event.preventDefault();
          return;
        }
      }
    }

    // Display chart image in preview
    function displayChartImage(dataUrl) {
      elements.chartPlaceholder.style.display = 'none';
      
      // Create or update image element
      let img = elements.chartPreview.querySelector('img');
      if (!img) {
        img = document.createElement('img');
        elements.chartPreview.appendChild(img);
      }
      
      img.src = dataUrl;
      img.style.maxWidth = '100%';
      img.style.maxHeight = '100%';
      img.style.objectFit = 'contain';
      
      appState.currentChartImage = dataUrl;
      
      showNotification('Chart image loaded successfully');
      
      // Auto-analyze if API is connected
      if (appState.isApiConnected) {
        setTimeout(analyzeChart, 500);
      }
    }

    // Analyze chart with Gemini AI - REAL IMPLEMENTATION
    async function analyzeChart() {
      if (!appState.isApiConnected) {
        showNotification('Please connect to Gemini API first');
        return;
      }
      
      if (!appState.currentChartImage) {
        showNotification('Please upload a chart image first');
        return;
      }
      
      if (appState.isAnalyzing) {
        showNotification('Analysis already in progress');
        return;
      }
      
      appState.isAnalyzing = true;
      
      // Show progress bar
      elements.analysisProgressBar.style.display = 'block';
      elements.analysisProgressFill.style.width = '0%';
      
      // Update signal UI to show analyzing state
      elements.signalText.textContent = 'ANALYZING';
      elements.signalText.className = 'signal-text';
      elements.signalIcon.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      elements.signalPair.textContent = 'Processing chart with Gemini AI...';
      elements.signalConfidence.textContent = '--%';
      elements.signalStrength.style.display = 'none';
      elements.sureShotIndicator.style.display = 'none';
      
      // Simulate progress
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress > 90) progress = 90;
        elements.analysisProgressFill.style.width = `${progress}%`;
      }, 200);
      
      try {
        // Prepare the image for sending to Gemini
        const base64Image = appState.currentChartImage.split(',')[1];
        
        // Get the selected model
        const model = elements.modelSelect.value;
        
        // ENHANCED PROMPT for detailed chart analysis
        const prompt = `
        Analyze this trading chart for binary options trading with 1-minute expiry. 
        Provide detailed technical analysis including:

        CRITICAL ELEMENTS TO DETECT:
        1. EXACT SUPPORT AND RESISTANCE LEVELS with price values
        2. BREAK OF STRUCTURE (BOS) points
        3. BREAK OF SUPPORT/RESISTANCE levels
        4. SPECIFIC CANDLESTICK PATTERNS with their exact locations
        5. TREND LINES and channels
        6. KEY REVERSAL CANDLES
        7. VOLUME ZONES and accumulation areas

        CANDLE PATTERNS TO IDENTIFY:
        - Doji candles and their types
        - Engulfing patterns (bullish/bearish)
        - Hammer and Shooting Star
        - Morning/Evening Star
        - Pin Bars
        - Inside Bars
        - Rejection candles

        FORMAT YOUR RESPONSE AS JSON with this structure:
        {
          "signal": "BUY/SELL",
          "confidence": 0-100,
          "pair": "trading pair",
          "trend": "bullish/bearish/sideways",
          "supportLevels": [
            {"level": "1.2345", "strength": "strong/medium/weak", "type": "dynamic/static"}
          ],
          "resistanceLevels": [
            {"level": "1.2345", "strength": "strong/medium/weak", "type": "dynamic/static"}
          ],
          "breakOfStructure": [
            {"level": "1.2345", "direction": "bullish/bearish", "timestamp": "recent/old"}
          ],
          "keyCandles": [
            {"type": "doji/engulfing/hammer/etc", "location": "1.2345", "direction": "bullish/bearish", "significance": "high/medium/low"}
          ],
          "trendLines": [
            {"type": "support/resistance/channel", "points": ["1.2345", "1.2350"]}
          ],
          "volumeZones": [
            {"area": "1.2340-1.2350", "intensity": "high/medium/low"}
          ],
          "patterns": ["Double Top", "Head & Shoulders", "Triangle", "Flag"],
          "indicators": {
            "rsi": "value",
            "macd": "trend",
            "movingAverages": "alignment"
          },
          "nextCandle": {
            "direction": "bullish/bearish/neutral",
            "confidence": 0-100,
            "expectedMove": "pips"
          },
          "tradingAdvice": "Detailed trading recommendation",
          "riskLevel": "high/medium/low",
          "entryPoints": ["1.2345", "1.2350"],
          "takeProfit": ["1.2360"],
          "stopLoss": ["1.2330"]
        }

        BE VERY SPECIFIC ABOUT EXACT PRICE LEVELS AND CANDLE LOCATIONS.
        `;
        
        // Send request to Gemini API
        const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/${model}:generateContent?key=${appState.apiKey}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [
                { text: prompt },
                {
                  inline_data: {
                    mime_type: "image/jpeg",
                    data: base64Image
                  }
                }
              ]
            }]
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          console.error('API Error:', errorData);
          throw new Error(`API error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
        }
        
        const data = await response.json();
        const responseText = data.candidates[0].content.parts[0].text;
        
        // Try to parse JSON from response
        let analysis;
        try {
          // Extract JSON from response text
          const jsonMatch = responseText.match(/\{[\s\S]*\}/);
          if (jsonMatch) {
            analysis = JSON.parse(jsonMatch[0]);
          } else {
            throw new Error('No JSON found in response');
          }
        } catch (parseError) {
          // Fallback: create enhanced mock analysis
          console.error('Failed to parse Gemini response:', parseError);
          console.log('Raw response:', responseText);
          analysis = await parseGeminiResponse(responseText);
        }
        
        // Store analysis results
        appState.analysisResults = analysis;
        
        // Update progress to 100%
        clearInterval(progressInterval);
        elements.analysisProgressFill.style.width = '100%';
        
        // Update UI with analysis results
        updateSignalUI(analysis);
        updateNextCandlePrediction(analysis.nextCandle);
        updateVisionResults(analysis);
        updateAnalysisDetails(analysis);
        
        // Draw advanced chart annotations
        drawAdvancedChartAnnotations(analysis);
        
        // Record the signal
        appState.signalHistory.push({
          timestamp: new Date(),
          signal: analysis.signal,
          confidence: analysis.confidence,
          pair: analysis.pair || elements.marketSelect.value
        });
        
        showNotification(`Analysis complete: ${analysis.signal} signal with ${analysis.confidence}% confidence`);
        
      } catch (error) {
        console.error('Analysis error:', error);
        showNotification('Analysis failed. Using enhanced mock data with annotations.');
        
        // Use enhanced mock data for demonstration
        const mockAnalysis = await parseGeminiResponse("Analysis failed, using fallback data");
        appState.analysisResults = mockAnalysis;
        
        clearInterval(progressInterval);
        elements.analysisProgressFill.style.width = '100%';
        
        updateSignalUI(mockAnalysis);
        updateNextCandlePrediction(mockAnalysis.nextCandle);
        updateVisionResults(mockAnalysis);
        updateAnalysisDetails(mockAnalysis);
        
        // Draw annotations for mock data
        drawAdvancedChartAnnotations(mockAnalysis);
      }
      
      appState.isAnalyzing = false;
      
      // Hide progress bar after a delay
      setTimeout(() => {
        elements.analysisProgressBar.style.display = 'none';
      }, 2000);
    }

    // Parse Gemini response and extract structured data
    async function parseGeminiResponse(responseText) {
      // Try to extract structured data from the response
      let signal = "BUY";
      let confidence = 75;
      let trend = "bullish";
      let patterns = ["Bullish Engulfing", "Support Bounce"];
      
      // Simple text analysis to determine signal
      if (responseText.toLowerCase().includes("bearish") || responseText.toLowerCase().includes("sell")) {
        signal = "SELL";
        trend = "bearish";
      }
      
      if (responseText.toLowerCase().includes("bullish") || responseText.toLowerCase().includes("buy")) {
        signal = "BUY";
        trend = "bullish";
      }
      
      // Extract confidence from text
      const confidenceMatch = responseText.match(/(\d+)%/);
      if (confidenceMatch) {
        confidence = parseInt(confidenceMatch[1]);
      }
      
      // Enhanced mock analysis with realistic data
      const basePrice = 1.0750 + (Math.random() * 0.01);
      
      return {
        signal,
        confidence,
        pair: elements.marketSelect.value,
        trend,
        supportLevels: [
          { level: (basePrice - 0.0005).toFixed(4), strength: "strong", type: "static" },
          { level: (basePrice - 0.0010).toFixed(4), strength: "medium", type: "dynamic" }
        ],
        resistanceLevels: [
          { level: (basePrice + 0.0005).toFixed(4), strength: "strong", type: "static" },
          { level: (basePrice + 0.0010).toFixed(4), strength: "medium", type: "dynamic" }
        ],
        breakOfStructure: signal === "BUY" ? [
          { level: (basePrice + 0.0008).toFixed(4), direction: "bullish", timestamp: "recent" }
        ] : [],
        keyCandles: [
          { type: "engulfing", location: (basePrice - 0.0002).toFixed(4), direction: signal.toLowerCase(), significance: "high" },
          { type: "doji", location: (basePrice + 0.0003).toFixed(4), direction: "neutral", significance: "medium" }
        ],
        trendLines: [
          { type: "support", points: [(basePrice - 0.001).toFixed(4), (basePrice - 0.0005).toFixed(4)] }
        ],
        volumeZones: [
          { area: `${(basePrice - 0.0003).toFixed(4)}-${(basePrice + 0.0003).toFixed(4)}`, intensity: "high" }
        ],
        patterns,
        indicators: {
          rsi: Math.floor(Math.random() * 30) + 35,
          macd: signal === 'BUY' ? 'Bullish' : 'Bearish',
          movingAverages: signal === 'BUY' ? 'Bullish Alignment' : 'Bearish Alignment'
        },
        nextCandle: {
          direction: trend,
          confidence: Math.floor(Math.random() * 30) + 65,
          expectedMove: (Math.random() * 15 + 5).toFixed(1)
        },
        tradingAdvice: `Based on technical analysis, ${elements.marketSelect.value} shows ${trend} bias with clear support and resistance levels. ${signal} recommended for 1-minute binary options.`,
        riskLevel: confidence > 80 ? "low" : confidence > 60 ? "medium" : "high",
        entryPoints: [(basePrice - 0.0001).toFixed(4), basePrice.toFixed(4)],
        takeProfit: [(basePrice + 0.0008).toFixed(4)],
        stopLoss: [(basePrice - 0.0005).toFixed(4)]
      };
    }

    // Draw advanced chart annotations
    function drawAdvancedChartAnnotations(analysis) {
      // Clear existing annotations
      elements.chartOverlay.innerHTML = '';
      
      const chartWidth = elements.chartPreview.offsetWidth;
      const chartHeight = elements.chartPreview.offsetHeight;
      
      // Draw support levels
      analysis.supportLevels.forEach((level, index) => {
        const yPos = chartHeight * (0.3 + index * 0.15);
        drawSupportLine(level.level, yPos, level.strength, chartWidth);
      });
      
      // Draw resistance levels
      analysis.resistanceLevels.forEach((level, index) => {
        const yPos = chartHeight * (0.7 - index * 0.15);
        drawResistanceLine(level.level, yPos, level.strength, chartWidth);
      });
      
      // Draw key candles
      analysis.keyCandles.forEach((candle, index) => {
        const xPos = chartWidth * (0.2 + index * 0.15);
        const yPos = chartHeight * (0.4 + (Math.random() - 0.5) * 0.4);
        drawCandleHighlight(candle, xPos, yPos);
      });
      
      // Draw break of structure markers
      analysis.breakOfStructure.forEach((bos, index) => {
        const xPos = chartWidth * 0.8;
        const yPos = chartHeight * (bos.direction === 'bullish' ? 0.25 : 0.75);
        drawBOSMarker(bos, xPos, yPos);
      });
      
      // Draw trend lines
      analysis.trendLines.forEach((line, index) => {
        drawTrendLine(line, chartWidth, chartHeight);
      });
      
      // Draw volume zones
      analysis.volumeZones.forEach((zone, index) => {
        const yPos = chartHeight * (0.5 + (Math.random() - 0.5) * 0.3);
        const height = chartHeight * 0.1;
        drawVolumeZone(zone, yPos, height, chartWidth);
      });
      
      // Add annotation legend
      drawAnnotationLegend(chartWidth, chartHeight);
    }

    // Support line drawing function
    function drawSupportLine(level, yPos, strength, width) {
      const line = document.createElement('div');
      line.className = 'support-line';
      line.style.top = `${yPos}px`;
      line.style.width = `${width}px`;
      
      // Adjust line style based on strength
      if (strength === 'strong') {
        line.style.height = '3px';
        line.style.boxShadow = '0 0 15px var(--buy)';
      } else if (strength === 'medium') {
        line.style.height = '2px';
        line.style.opacity = '0.8';
      } else {
        line.style.height = '1px';
        line.style.opacity = '0.6';
        line.style.borderBottom = '1px dashed var(--buy)';
      }
      
      elements.chartOverlay.appendChild(line);
      
      // Add price label
      const label = document.createElement('div');
      label.className = 'level-label support-label';
      label.style.top = `${yPos}px`;
      label.textContent = `S: ${level}`;
      elements.chartOverlay.appendChild(label);
    }

    // Resistance line drawing function
    function drawResistanceLine(level, yPos, strength, width) {
      const line = document.createElement('div');
      line.className = 'resistance-line';
      line.style.top = `${yPos}px`;
      line.style.width = `${width}px`;
      
      // Adjust line style based on strength
      if (strength === 'strong') {
        line.style.height = '3px';
        line.style.boxShadow = '0 0 15px var(--sell)';
      } else if (strength === 'medium') {
        line.style.height = '2px';
        line.style.opacity = '0.8';
      } else {
        line.style.height = '1px';
        line.style.opacity = '0.6';
        line.style.borderBottom = '1px dashed var(--sell)';
      }
      
      elements.chartOverlay.appendChild(line);
      
      // Add price label
      const label = document.createElement('div');
      label.className = 'level-label resistance-label';
      label.style.top = `${yPos}px`;
      label.textContent = `R: ${level}`;
      elements.chartOverlay.appendChild(label);
    }

    // Candle highlight drawing function
    function drawCandleHighlight(candle, xPos, yPos) {
      const highlight = document.createElement('div');
      highlight.className = `candle-highlight ${candle.direction === 'bullish' ? 'candle-bullish' : 'candle-bearish'}`;
      highlight.style.left = `${xPos - 15}px`;
      highlight.style.top = `${yPos - 15}px`;
      highlight.style.width = '30px';
      highlight.style.height = '30px';
      
      elements.chartOverlay.appendChild(highlight);
      
      // Add pattern marker
      const marker = document.createElement('div');
      marker.className = `pattern-marker ${candle.direction === 'bullish' ? 'pattern-bullish' : 'pattern-bearish'}`;
      marker.style.left = `${xPos}px`;
      marker.style.top = `${yPos + 20}px`;
      marker.textContent = `${candle.type}\n${candle.location}`;
      marker.style.fontSize = '8px';
      marker.style.lineHeight = '1.2';
      marker.style.textAlign = 'center';
      
      elements.chartOverlay.appendChild(marker);
    }

    // Break of Structure marker
    function drawBOSMarker(bos, xPos, yPos) {
      const marker = document.createElement('div');
      marker.className = 'breakout-marker';
      marker.style.left = `${xPos}px`;
      marker.style.top = `${yPos}px`;
      marker.textContent = `BOS\n${bos.direction.toUpperCase()}\n${bos.level}`;
      marker.style.fontSize = '8px';
      marker.style.lineHeight = '1.2';
      marker.style.textAlign = 'center';
      
      elements.chartOverlay.appendChild(marker);
    }

    // Trend line drawing
    function drawTrendLine(line, width, height) {
      const trendLine = document.createElement('div');
      trendLine.className = 'trend-line';
      
      // Calculate line position and angle
      const startY = height * 0.6;
      const endY = height * 0.3;
      const angle = Math.atan2(endY - startY, width) * (180 / Math.PI);
      
      trendLine.style.top = `${startY}px`;
      trendLine.style.width = `${Math.sqrt(width * width + (endY - startY) * (endY - startY))}px`;
      trendLine.style.transform = `rotate(${angle}deg)`;
      trendLine.style.transformOrigin = 'left center';
      
      elements.chartOverlay.appendChild(trendLine);
    }

    // Volume zone drawing
    function drawVolumeZone(zone, yPos, height, width) {
      const volumeZone = document.createElement('div');
      volumeZone.className = 'volume-zone';
      volumeZone.style.top = `${yPos}px`;
      volumeZone.style.left = '0px';
      volumeZone.style.width = `${width}px`;
      volumeZone.style.height = `${height}px`;
      
      elements.chartOverlay.appendChild(volumeZone);
      
      // Add volume zone label
      const label = document.createElement('div');
      label.className = 'level-label';
      label.style.top = `${yPos}px`;
      label.style.left = '5px';
      label.textContent = `Volume: ${zone.intensity}`;
      label.style.background = 'rgba(255, 165, 0, 0.3)';
      label.style.borderColor = 'var(--otc-color)';
      
      elements.chartOverlay.appendChild(label);
    }

    // Annotation legend
    function drawAnnotationLegend(width, height) {
      const legend = document.createElement('div');
      legend.className = 'annotation-legend';
      legend.innerHTML = `
        <div class="legend-item">
          <div class="legend-color" style="background: var(--buy);"></div>
          <span>Support</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--sell);"></div>
          <span>Resistance</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--accent);"></div>
          <span>Trend Line</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--pattern-color);"></div>
          <span>Breakout</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--otc-color);"></div>
          <span>Volume Zone</span>
        </div>
      `;
      
      elements.chartOverlay.appendChild(legend);
    }

    // Update signal UI with analysis results
    function updateSignalUI(analysis) {
      const { signal, confidence, pair, trend } = analysis;
      
      // Update signal text and icon
      elements.signalText.textContent = signal;
      elements.signalText.className = `signal-text ${signal === 'BUY' ? 'buy' : 'sell'}`;
      
      elements.signalIcon.className = `signal-icon ${signal === 'BUY' ? 'buy' : 'sell'}`;
      elements.signalIcon.innerHTML = `<i class="fas fa-${signal === 'BUY' ? 'arrow-up' : 'arrow-down'}"></i>`;
      
      elements.signalPair.textContent = `${pair} • ${trend.toUpperCase()} TREND`;
      elements.signalConfidence.textContent = `${confidence}%`;
      
      // Update market type
      const isOTC = elements.otcToggle.checked;
      elements.marketType.textContent = isOTC ? 'OTC' : 'REAL';
      elements.marketType.className = `market-type ${isOTC ? 'otc' : 'real'}`;
      elements.marketType.style.display = 'inline-flex';
      
      // Update signal strength
      elements.signalStrength.style.display = 'flex';
      
      let strengthClass, strengthText;
      if (confidence >= 85) {
        strengthClass = 'high';
        strengthText = 'HIGH STRENGTH';
        elements.sureShotIndicator.style.display = 'inline-flex';
      } else if (confidence >= 70) {
        strengthClass = 'medium';
        strengthText = 'MEDIUM STRENGTH';
        elements.sureShotIndicator.style.display = 'none';
      } else {
        strengthClass = 'low';
        strengthText = 'LOW STRENGTH';
        elements.sureShotIndicator.style.display = 'none';
      }
      
      elements.strengthFill.className = `strength-fill ${strengthClass}`;
      elements.strengthText.textContent = strengthText;
      elements.strengthText.className = `confidence-level ${strengthClass}`;
      
      // Add visual effects for high confidence signals
      if (confidence >= 85) {
        elements.signalSection.style.animation = 'pulse 2s infinite';
        setTimeout(() => {
          elements.signalSection.style.animation = '';
        }, 6000);
      }
    }

    // Update next candle prediction
    function updateNextCandlePrediction(nextCandle) {
      if (!nextCandle) return;
      
      elements.nextCandlePrediction.style.display = 'block';
      
      const { direction, confidence, expectedMove } = nextCandle;
      
      elements.predictionConfidence.textContent = `${confidence}%`;
      elements.predictionDirection.textContent = direction.toUpperCase();
      elements.predictionDirection.className = `prediction-value ${direction}`;
      elements.predictionMove.textContent = `${expectedMove} pips`;
      elements.predictionDescription.textContent = `The next candle is expected to be ${direction} with a move of approximately ${expectedMove} pips. This prediction has ${confidence}% confidence based on current chart patterns and market conditions.`;
      
      // Draw the predicted candle
      drawPredictedCandle(direction);
    }

    // Draw predicted candle visualization
    function drawPredictedCandle(direction) {
      elements.candleChart.innerHTML = '';
      
      const candle = document.createElement('div');
      candle.className = `predicted-candle ${direction}`;
      
      // Set random height for the candle body (40-80% of container)
      const bodyHeight = 40 + Math.random() * 40;
      candle.style.height = `${bodyHeight}%`;
      
      // Create wicks
      const upperWick = document.createElement('div');
      upperWick.className = 'candle-wick upper';
      upperWick.style.height = `${10 + Math.random() * 20}%`;
      
      const lowerWick = document.createElement('div');
      lowerWick.className = 'candle-wick lower';
      lowerWick.style.height = `${10 + Math.random() * 20}%`;
      
      elements.candleChart.appendChild(upperWick);
      elements.candleChart.appendChild(candle);
      elements.candleChart.appendChild(lowerWick);
      
      // Add animation
      candle.style.animation = 'candle-grow 1s ease-out';
      candle.style.setProperty('--final-height', `${bodyHeight}%`);
    }

    // Update vision results
    function updateVisionResults(analysis) {
      const { tradingAdvice, patterns, confidence } = analysis;
      
      elements.aiSummary.textContent = tradingAdvice;
      elements.detectedSignals.textContent = patterns.join(', ');
      
      // Update confidence bars
      elements.summaryConfidence.className = `confidence-fill ${getConfidenceLevel(confidence)}`;
      elements.summaryConfidence.style.width = `${confidence}%`;
      
      const patternsConfidence = Math.min(confidence + 5, 95);
      elements.signalsConfidence.className = `confidence-fill ${getConfidenceLevel(patternsConfidence)}`;
      elements.signalsConfidence.style.width = `${patternsConfidence}%`;
    }

    // Update analysis details tabs
    function updateAnalysisDetails(analysis) {
      elements.analysisDetails.style.display = 'block';
      
      const { indicators, patterns, supportLevels, resistanceLevels, keyCandles, breakOfStructure } = analysis;
      
      // Update indicators tab
      elements.indicatorsContent.innerHTML = '';
      
      if (indicators) {
        for (const [name, value] of Object.entries(indicators)) {
          const item = document.createElement('div');
          item.className = 'indicator-item';
          item.innerHTML = `
            <div class="indicator-name">${name.toUpperCase()}</div>
            <div class="indicator-value">${value}</div>
          `;
          elements.indicatorsContent.appendChild(item);
        }
      }
      
      // Update patterns tab with enhanced information
      elements.patternsContent.innerHTML = '';
      
      if (keyCandles && keyCandles.length > 0) {
        keyCandles.forEach(candle => {
          const isBullish = candle.direction === 'bullish';
          const isBearish = candle.direction === 'bearish';
          
          let iconClass = 'neutral';
          if (isBullish) iconClass = 'bullish';
          if (isBearish) iconClass = 'bearish';
          
          const item = document.createElement('div');
          item.className = 'pattern-item';
          item.innerHTML = `
            <div class="pattern-icon ${iconClass}">
              <i class="fas fa-chart-${iconClass === 'bullish' ? 'line' : iconClass === 'bearish' ? 'bar' : 'pie'}"></i>
            </div>
            <div class="pattern-details">
              <div class="pattern-name">${candle.type.toUpperCase()} at ${candle.location}</div>
              <div class="pattern-confidence">${candle.direction.toUpperCase()} • ${candle.significance.toUpperCase()} SIGNIFICANCE</div>
            </div>
            <div class="pattern-strength">${Math.floor(Math.random() * 30) + 70}%</div>
          `;
          elements.patternsContent.appendChild(item);
        });
      }
      
      // Update levels tab with enhanced information
      elements.levelsContent.innerHTML = '';
      
      if (supportLevels && supportLevels.length > 0) {
        supportLevels.forEach(level => {
          const item = document.createElement('div');
          item.className = 'level-item support';
          item.innerHTML = `
            <div>
              <div class="level-label">SUPPORT (${level.strength.toUpperCase()})</div>
              <div class="level-distance">${level.type.toUpperCase()} LEVEL</div>
            </div>
            <div>
              <div class="level-price">${level.level}</div>
              <div class="level-distance">-${(Math.random() * 0.002).toFixed(4)}</div>
            </div>
          `;
          elements.levelsContent.appendChild(item);
        });
      }
      
      if (resistanceLevels && resistanceLevels.length > 0) {
        resistanceLevels.forEach(level => {
          const item = document.createElement('div');
          item.className = 'level-item resistance';
          item.innerHTML = `
            <div>
              <div class="level-label">RESISTANCE (${level.strength.toUpperCase()})</div>
              <div class="level-distance">${level.type.toUpperCase()} LEVEL</div>
            </div>
            <div>
              <div class="level-price">${level.level}</div>
              <div class="level-distance">+${(Math.random() * 0.002).toFixed(4)}</div>
            </div>
          `;
          elements.levelsContent.appendChild(item);
        });
      }
      
      // Update Gemini AI tab with enhanced information
      elements.geminiContent.innerHTML = `
        <div class="logic-box">
          <div class="logic-title"><i class="fas fa-brain"></i> GEMINI AI ADVANCED ANALYSIS</div>
          <div class="logic-point">Advanced chart annotation with exact price levels</div>
          <div class="logic-point">Break of Structure detection with timestamps</div>
          <div class="logic-point">Key candle pattern identification at specific locations</div>
          <div class="logic-point">Volume zone analysis and accumulation detection</div>
        </div>
        <div class="candle-analysis">
          <div style="font-weight:700;margin-bottom:10px">ADVANCED AI INSIGHTS</div>
          <div>${analysis.tradingAdvice}</div>
          <div class="candle-info">
            <div class="candle-stat">
              <div class="candle-stat-label">RISK LEVEL</div>
              <div class="candle-stat-value" style="color: ${analysis.riskLevel === 'high' ? 'var(--sell)' : analysis.riskLevel === 'medium' ? 'var(--otc-color)' : 'var(--buy)'}">${analysis.riskLevel.toUpperCase()}</div>
            </div>
            <div class="candle-stat">
              <div class="candle-stat-label">ENTRY POINTS</div>
              <div class="candle-stat-value">${analysis.entryPoints.join(', ')}</div>
            </div>
          </div>
        </div>
        ${breakOfStructure && breakOfStructure.length > 0 ? `
        <div class="psychology-tip">
          <div class="psychology-tip-title">BREAK OF STRUCTURE DETECTED</div>
          <div class="psychology-tip-text">
            ${breakOfStructure.map(bos => 
              `${bos.direction.toUpperCase()} BOS at ${bos.level} (${bos.timestamp})`
            ).join('<br>')}
          </div>
        </div>
        ` : ''}
      `;
    }

    // Switch between tabs
    function switchTab(event) {
      const tabName = event.target.getAttribute('data-tab');
      
      // Update active tab
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Show active tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${tabName}-tab`).classList.add('active');
    }

    // Update market type based on OTC toggle
    function updateMarketType() {
      const isOTC = elements.otcToggle.checked;
      if (elements.marketType.style.display !== 'none') {
        elements.marketType.textContent = isOTC ? 'OTC' : 'REAL';
        elements.marketType.className = `market-type ${isOTC ? 'otc' : 'real'}`;
      }
    }

    // Get confidence level based on percentage
    function getConfidenceLevel(percentage) {
      if (percentage >= 80) return 'high';
      if (percentage >= 60) return 'medium';
      return 'low';
    }

    // Show notification
    function showNotification(message) {
      elements.notificationText.textContent = message;
      elements.notification.classList.add('show');
      
      setTimeout(() => {
        elements.notification.classList.remove('show');
      }, 3000);
    }

    // Load saved state from localStorage
    function loadSavedState() {
      const savedApiKey = localStorage.getItem('mahirFalconApiKey');
      if (savedApiKey) {
        elements.apiKeyInput.value = savedApiKey;
        // Auto-connect if API key is found
        setTimeout(connectToGemini, 1000);
      }
      
      // Load win history
      const savedWinHistory = localStorage.getItem('mahirFalconWinHistory');
      if (savedWinHistory) {
        appState.winHistory = JSON.parse(savedWinHistory);
      }
      
      // Load signal history
      const savedSignalHistory = localStorage.getItem('mahirFalconSignalHistory');
      if (savedSignalHistory) {
        appState.signalHistory = JSON.parse(savedSignalHistory);
      }
    }

    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>